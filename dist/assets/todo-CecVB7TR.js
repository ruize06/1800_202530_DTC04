import{q as I,w as B,c as L,d as l,g as N,a as w,b as k,e as O,o as U,u as T,f as S,h as $,i as K,j as X,k as Y}from"./style-gcIZDgIN.js";import"./bottom-nav-3YuBZoxf.js";import{i as Z,a as J,h as M,s as A,c as V,b as C,d as q}from"./popup-form-header-TXQSeuBU.js";import{o as G}from"./authentication-DKrwougs.js";import{s as H}from"./alert-DANZG7mw.js";class D extends HTMLElement{static get observedAttributes(){return["date","time","icon","color","title","description"]}constructor(){super()}connectedCallback(){this.render();for(let t in D.observedAttributes)this.setAttribute(D.observedAttributes[t],null)}render(){this.className="flex flex-row max-w-full space-x-4",this.innerHTML=`
            <div
                class="task-box shadow-lg flex flex-col md:flex-row justify-between grow hover:scale-105 hover:[&_.task-description]:block rounded-xl p-4 transition-all duration-250">

                <div class="task-description-container flex flex-row space-x-4 md:max-w-[70%]">
                    <!-- no icon for now bc it takes too much space
                    <div class="task-icon-container flex-none">
                    </div>
                    -->

                    <div class="task-title-container h-auto">
                        <h1 class="task-title text-xl font-semibold overflow-hidden text-ellipsis">
                        </h1>
                        <p class="task-description hidden w-full break-all text-wrap overflow-hidden text-ellipsis max-h-[6ch]">
                        </p>
                    </div>
                </div>

                <div class="task-details-container flex flex-row md:flex-col max-w-fit items-end gap-2">
                    <div class="task-date hidden">
                        <span class="task-day"></span> /
                        <span class="task-month"></span> /
                        <span class="task-year"></span>
                    </div>

                    <div class="task-time hidden">
                        <span class="task-hour"></span>:<span class="task-minute"></span>
                    </div>
                </div>
            </div>
        `}attributeChangedCallback(t,o,e){if(t==="title")this.getElementsByClassName("task-title")[0].textContent=e;else if(t==="description")this.getElementsByClassName("task-description")[0].innerHTML=e;else if(t==="color"){this.getElementsByClassName("task-box")[0].style.backgroundColor=e;const a=Z(e)?"#000000":"#ffffff";this.getElementsByClassName("task-box")[0].style.color=a,this.style.textDecorationColor=a}else t==="date"&&e!==null&&e!="null"&&e!=""?(e=e.split("-"),this.getElementsByClassName("task-date")[0].classList.toggle("hidden",!1),this.getElementsByClassName("task-year")[0].textContent=e[0],this.getElementsByClassName("task-month")[0].textContent=e[1],this.getElementsByClassName("task-day")[0].textContent=e[2]):t==="time"&&e!=null&&e!="null"&&e!=""&&(e=e.split(":"),this.getElementsByClassName("task-time")[0].classList.toggle("hidden",!1),this.getElementsByClassName("task-hour")[0].textContent=e[0],this.getElementsByClassName("task-minute")[0].textContent=e[1])}}customElements.define("task-box",D);class ee extends HTMLElement{render(){this.innerHTML=`
            <div class="share-icon float-right max-w-[24px] hover:scale-120 transition-transform duration-250 mt-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    class=" icon icon-tabler icons-tabler-outline icon-tabler-share-3">
                    <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                    <path d="M13 4v4c-6.575 1.028 -9.02 6.788 -10 12c-.037 .206 5.384 -5.962 10 -6v4l8 -7l-8 -7z" />
                </svg>
            </div>
        `}connectedCallback(){this.render()}}customElements.define("share-button",ee);class te extends HTMLElement{static get observedAttributes(){return["checked"]}render(){this.innerHTML=`
            <div class="complete-icon float-left max-w-[24px] hover:scale-120 transition-transform duration-250 mt-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    class="incompleteSVG icon icon-tabler icons-tabler-outline icon-tabler-circle">
                    <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                    <path d="M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0" />
                </svg>
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                    viewBox="0 0 24 24" fill="currentColor"
                    class="completedSVG hidden icon icon-tabler icons-tabler-filled icon-tabler-circle-check">
                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                    <path d="M17 3.34a10 10 0 1 1 -14.995 8.984l-.005 -.324l.005 -.324a10 10 0 0 1 14.995 -8.336zm-1.293 5.953a1 1 0 0 0 -1.32 -.083l-.094 .083l-3.293 3.292l-1.293 -1.292l-.094 -.083a1 1 0 0 0 -1.403 1.403l.083 .094l2 2l.094 .083a1 1 0 0 0 1.226 0l.094 -.083l4 -4l.083 -.094a1 1 0 0 0 -.083 -1.32z" />
                </svg>
            </div>
        `}connectedCallback(){this.render(),this.addEventListener("click",()=>{const t=this.getAttribute("checked");this.setAttribute("checked",!(t=="true"||t==!0))})}attributeChangedCallback(t,o,e){t==="checked"&&(e==!0||e=="true"?(console.log("completed"),this.getElementsByClassName("completedSVG")[0].classList.remove("hidden"),this.getElementsByClassName("incompleteSVG")[0].classList.add("hidden")):(console.log("uncompleted"),this.getElementsByClassName("incompleteSVG")[0].classList.remove("hidden"),this.getElementsByClassName("completedSVG")[0].classList.add("hidden")))}}customElements.define("complete-button",te);class se extends HTMLElement{static get observedAttributes(){return["title","added","img"]}constructor(){super()}render(){this.innerHTML=`
        <div class="bg-[var(--bg-color)] px-3 py-2 rounded-full flex justify-between items-center shadow-sm max-w-full mx-auto">
            <div class="flex items-center space-x-4">
                <img class="searchResultImg hidden rounded-full w-10 h-10 object-cover" src="" alt="Profile Image">
                <h1 class="searchResultTitle text-[var(--text-color)] md:text-xl font-semibold text-nowrap overflow-hidden text-ellipsis">
                </h1>
            </div>
            <button class="searchResultAddButton px-3 py-1 rounded-full text-sm text-[var(--contrast-text-color)] bg-[var(--primary-button-bg-color)] hover:bg-[var(--secondary-button-bg-color)]">
            </button>
        </div>
        `}connectedCallback(){this.render(),this.setAttribute("added",!1),this.setAttribute("title","")}attributeChangedCallback(t,o,e){if(t==="added")if(e==="true"||e===!0){const a=this.getElementsByClassName("searchResultAddButton")[0];a.classList.remove("bg-[var(--primary-button-bg-color)]","hover:bg-[var(--secondary-button-bg-color)]"),a.classList.add("bg-[var(--deactive-button-bg-color)]"),a.innerText="Added"}else{const a=this.getElementsByClassName("searchResultAddButton")[0];a.classList.add("bg-[var(--primary-button-bg-color)]","hover:bg-[var(--secondary-button-bg-color)]"),a.classList.remove("bg-[var(--deactive-button-bg-color)]"),a.innerText="Add"}else t==="img"?(e==null||e===""?this.getElementsByClassName("searchResultImg")[0].classList.add("hidden"):this.getElementsByClassName("searchResultImg")[0].classList.remove("hidden"),this.getElementsByClassName("searchResultImg")[0].src=e):t==="title"&&(this.getElementsByClassName("searchResultTitle")[0].innerHTML=e)}}customElements.define("search-add-result",se);function P(s,t,o){s.preventDefault(),G(async e=>{const a=t.value.trim();if(a==="")var d=I(L(l,"groups"),B("members","array-contains",e.uid));else var d=I(L(l,"groups"),B("name",">=",a),B("name","<=",a+"~"),B("members","array-contains",e.uid));const i=await N(d);i.empty?o.innerHTML="No matches found.":(o.innerHTML="",i.forEach(r=>{if(r.id===localStorage.getItem("todoGroupID"))return;const f=r.data();var n=document.createElement("search-add-result");o.append(n),n.setAttribute("title",f.name),n.setAttribute("img",f.profilePicture||""),n.setAttribute("added",o.added.includes(r.id)),n.getElementsByClassName("searchResultAddButton")[0].addEventListener("click",()=>{o.addedRecent=!0,o.added.includes(r.id)?(n.setAttribute("added",!1),J(o.added,r.id)):(n.setAttribute("added",!0),o.added.push(r.id))})}))})}function oe(s){const t=document.getElementById("share-task-search-form"),o=document.getElementById("share-task-form-container"),e=document.getElementById("shareSearchResultsDiv");t?.reset(),e.innerHTML="",e.added=[],A(o),o.focus();const a=new Event("submit");t.dispatchEvent(a);var d=document.getElementById("tasksToShareDiv");d.innerHTML="";const i=s.target.closest("task-box");var r=V(i,d);r.setAttribute("disabled",!0),r.classList.add("scale-70"),r.classList.add("pointer-events-none")}function Q(){const s=document.getElementById("share-task-form-container"),t=document.getElementById("shareSearchResultsDiv");if(t.addedRecent){t.addedRecent=!1,s.focus();return}M(s)}async function ae(s){s.preventDefault(),G(async t=>{const o=document.getElementById("shareSearchResultsDiv"),e=o.added;if(document.getElementById("saveToOwn").checked&&(e.push(t.uid),console.log(e)),e.length===0){o.addedRecent=!0,H("No groups have been added yet!","warning"),o.addedRecent=!0;return}const d=document.getElementById("tasksToShareDiv"),i=L(l,"tasks");for(let f of d.children){const n=await w(k(i,f.id));for(let m of e){var r=n.data();r.ownerID=m,r.completed=!1,await O(i,r)}}Q(),H("Task shared successfully!","success")})}async function ne(s,t){s.preventDefault();var o=new FormData(s.target);o=Object.fromEntries([...o.entries()]),o.ownerID=t,o.completed="false";const e=L(l,"tasks"),a=await O(e,o),d=await w(a);return W(),[d]}function re(){var s=document.getElementById("add-task-form"),t=document.getElementById("add-task-form-container");s?.reset(),A(t),t.focus()}function W(){var s=document.getElementById("add-task-form-container");M(s)}function ce(s,t){s.preventDefault();var o=new FormData(s.target);o=Object.fromEntries([...o.entries()]);const e=k(l,"tasks",s.target.taskID);T(e,o),F()}function de(s){s.preventDefault();const t=k(l,"tasks",document.getElementById("edit-task-form").taskID);S(t),F()}function ie(s){var t=document.getElementById("edit-task-form"),o=document.getElementById("edit-task-form-container");t?.reset();const e=s.target.closest("task-box");A(o),t.taskID=e.id,t.title.value=e.title,t.description.value=e.getAttribute("description"),t.color.value=e.getAttribute("color"),t.time.value=e.getAttribute("time"),t.date.value=e.getAttribute("date"),o.focus()}function F(){var s=document.getElementById("edit-task-form-container");M(s)}function R(){const s=document.getElementById("tasksTodoNumber"),t=document.getElementById("completedTasksNumber"),o=document.getElementById("allTasksNumber"),e=document.getElementById("noCompletedTasksMessage"),a=document.getElementById("my-tasks-container").children.length,d=document.getElementById("completed-list").children.length-1;s.innerHTML=a,t.innerHTML=d,o.innerHTML=a+d,d==0?e.classList.remove("hidden"):e.classList.add("hidden")}function j(s){const t=document.getElementById("my-tasks-container");s.forEach(o=>{var e=document.createElement("task-box");t.prepend(e),e.id=o.id,U(k(l,"tasks",o.id),a=>{if(a.exists()){const f=document.getElementById("my-tasks-container"),n=document.getElementById(a.id),m=document.getElementById("completed-list");var d=document.createElement("share-button"),i=document.createElement("complete-button"),r=a.data();r.completed==!0||r.completed=="true"?(m.prepend(n),n.classList.add("line-through","opacity-60")):(f.prepend(n),n.classList.remove("line-through","opacity-60")),n.prepend(i),n.appendChild(d),n.setAttribute("title",r.title),n.setAttribute("description",r.description),n.setAttribute("color",r.color),n.setAttribute("time",r.time),n.setAttribute("date",r.date),i.setAttribute("checked",r.completed),i.addEventListener("click",E=>{var b=i.getAttribute("checked"),c=E.target.closest("task-box");console.log(b),b===!0||b==="true"?c.classList.add("line-through","opacity-80"):c.classList.remove("line-through","opacity-60"),setTimeout(async()=>{await T(k(l,"tasks",E.target.closest("task-box").id),{completed:b})},400)});const u=document.getElementById("edit-task-form-container"),_=u.querySelector(".cancelButton");C(n.getElementsByClassName("task-box")[0],_,u,ie,F);const h=document.getElementById("share-task-form-container"),p=h.querySelector(".cancelButton");C(n.getElementsByClassName("share-icon")[0],p,h,oe,Q),R()}else console.log("removed task"),document.getElementById(a.id).remove(),R()})})}function le(){const s=document.getElementById("add-task-button"),t=document.getElementById("add-task-form"),o=document.getElementById("add-task-form-container"),e=o.querySelector(".cancelButton"),a=document.getElementById("edit-task-form"),d=a.delete,i=document.getElementById("share-task-search-form"),r=i.searchGroups,f=document.getElementById("shareSearchResultsDiv"),n=document.getElementById("share-task-form"),m=document.getElementById("showCompleted"),u=document.getElementById("completed-list");R(),G(async _=>{const h=new URLSearchParams(window.location.search);var p=null;switch(console.log(h.get("type")),h.get("type")){case"user":p=_.uid,document.querySelector("bottom-nav").setAttribute("active",1);break;case"group":p=localStorage.getItem("todoGroupID"),document.querySelector("bottom-nav").setAttribute("active",2),U(k(l,"groups",p),c=>{if(p=localStorage.getItem("todoGroupID"),console.log(p),c.exists()){const g=document.getElementById("editGroup"),v=document.getElementById("addMember"),y=document.getElementById("backBtn"),x=c.data();document.getElementById("topNavTitle").innerText=x.name,g.classList.remove("hidden"),v.classList.remove("hidden"),y.classList.remove("hidden"),document.getElementById("saveToOwnDiv").classList.remove("hidden")}else console.warn("No gorup found"),window.location.href="/sharepage_Groups.html"});break;default:console.warn("No todo type specified")}p||(console.warn("No group ID found"),window.location.href="/sharepage_Groups.html");const E=I(L(l,"tasks"),B("ownerID","==",p));var b=await N(E);C(s,e,o,re,W),t?.addEventListener("submit",async c=>{const g=await ne(c,p);j(g)}),a?.addEventListener("submit",c=>{ce(c)}),d?.addEventListener("click",de),r?.addEventListener("input",c=>{P(c,r,f)}),i?.addEventListener("submit",c=>{P(c,r,f)}),n?.addEventListener("submit",c=>{ae(c)}),m.addEventListener("click",()=>{R(),u.classList.contains("completed-list")?(m.innerHTML="Hide Completed",m.classList.add("bg-[var(--secondary-button-bg-color)]"),m.classList.remove("bg-[var(--primary-button-bg-color)]"),u.classList.remove("hidden"),setTimeout(()=>{u.classList.remove("completed-list"),u.classList.add("completed-list-open")},0)):(m.innerHTML="Show Completed",m.classList.add("bg-[var(--primary-button-bg-color)]"),m.classList.remove("bg-[var(--secondary-button-bg-color)]"),u.classList.remove("completed-list-open"),u.classList.add("completed-list"),setTimeout(()=>{u.classList.add("hidden")},200))}),j(b)})}document.addEventListener("DOMContentLoaded",le);async function me(s){const t=I(L(l,"tasks"),B("ownerID","==",s.id));(await N(t)).forEach(async e=>{await S(e.ref)}),await S(s)}async function z(s,t){await T(s,{members:X(t)});const o=document.getElementById("groupMembersList");for(let a of o.children)a.id==t&&o.removeChild(a);const e=await w(s);console.log(e.data().members.length),e.data().members.length===0&&await me(s)}document.addEventListener("DOMContentLoaded",()=>{const s=document.getElementById("editGroupPopup"),t=document.getElementById("editGroup"),o=s.querySelector(".cancelButton"),e=document.getElementById("groupMembersList"),a=document.getElementById("leaveGroup"),d=localStorage.getItem("todoGroupID");let i=null;$(K,n=>{n&&(i=n.uid,console.log("Logged in as:",i))});async function r(){A(s),s.focus(),e.innerHTML="";const n=k(l,"groups",d),u=(await w(n)).data();groupNameInput.value=u.name,u.members.forEach(async h=>{const p=k(l,"userprofiles",h),b=(await w(p)).data(),c=document.createElement("li");c.id=h,c.className="bg-[var(--bg-color)] px-3 py-2 rounded-full flex justify-between items-center shadow-sm max-w-full mx-auto",e.appendChild(c);const g=document.createElement("div");g.className="flex items-center gap-4";const v=document.createElement("img");v.className="rounded-full w-10 h-10 object-cover",v.src=b.profilePicture||"/images/person.png",g.appendChild(v);const y=document.createElement("span");y.textContent=b.username||b.email,g.appendChild(y),c.appendChild(g);const x=document.createElement("button");h!==i&&(x.type="button",c.appendChild(x),x.textContent="Remove",x.className="px-3 py-2 text-sm rounded-full text-white bg-[var(--danger-button-bg-color)] hover:bg-[var(--secondary-button-bg-color)] hover:scale-105",x.addEventListener("click",()=>{q({message:`Remove ${b.username} from the group?`,onConfirm:async()=>{await z(n,h)}})}))})}groupNameChangeForm.addEventListener("submit",async n=>{n.preventDefault();const m=groupNameInput.value.trim();if(!m)return;const u=k(l,"groups",d);await T(u,{name:m}),console.log("Group name updated to:",m)});function f(){M(s)}a.addEventListener("click",()=>{const n=k(l,"groups",d);q({message:"Leave this group?",onConfirm:async()=>{await z(n,i),window.location.href="/sharepage_Groups.html"}})}),C(t,o,s,r,f)});document.addEventListener("DOMContentLoaded",()=>{const s=document.getElementById("addMemberPopup"),t=document.getElementById("addMember"),o=s.querySelector(".cancelButton"),e=document.getElementById("searchBtn"),a=document.getElementById("searchInput"),d=document.getElementById("searchResults");let i=null,r={},f=localStorage.getItem("todoGroupID");async function n(h){const p=k(l,"groups",h),b=(await w(p)).data().members,c={};return b.forEach(async g=>{const v=k(l,"userprofiles",g),y=await w(v);c[g]=y.data()}),c}async function m(){A(s),s.focus(),r=await n(f),d.innerHTML="",a.value="",_()}function u(){M(s)}async function _(){const h=a.value.trim();d.innerHTML="";const p=I(L(l,"userprofiles"),B("username",">=",h),B("username","<=",h+"ï£¿")),E=await N(p);if(E.empty)d.innerHTML="<li class='text-[var(--text-color)]'>No matches found.</li>";else{d.innerHTML="";const b=k(l,"groups",f);E.forEach(c=>{if(c.id===i)return;const g=c.data();var v=document.createElement("search-add-result");d.append(v);const y=v.querySelector(".searchResultAddButton");v.setAttribute("title",g.username),v.setAttribute("img",g.profilePicture||"/images/person.png"),c.id in r?(v.setAttribute("added",!0),y.disabled=!0):v.setAttribute("added",!1),y.addEventListener("click",async()=>{c.id in r?y.disabled=!0:(v.setAttribute("added",!0),await T(b,{members:Y(c.id)}),r[c.id]=g,H(`${g.username} has been added to the group!`,"success"))})})}}$(K,async h=>{i=h.uid,r=await n(f),e.addEventListener("click",_),a.addEventListener("input",_)}),C(t,o,s,m,u)});
