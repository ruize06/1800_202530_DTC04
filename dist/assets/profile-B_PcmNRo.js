import{u as L,b as y,d as E,s as A,h as F,i as C,o as U}from"./style-gcIZDgIN.js";import"./bottom-nav-3YuBZoxf.js";import"./top-nav-DYIFfsg9.js";import{s as i}from"./alert-DANZG7mw.js";function D(e,t,a){const u=document.getElementById("choose-avatar-btn"),n=document.getElementById("avatar-selector"),w=document.getElementById("close-avatar-selector"),P=document.getElementById("confirm-avatar"),p=document.getElementById("avatar-grid"),x=["/images/earth.png","/images/planet1.png","/images/planet2.png","/images/planet3.png","/images/sun.png","/images/planet5.png"];let l=null;p.innerHTML="",x.forEach(m=>{const o=document.createElement("img");o.src=m,o.classList.add("w-20","h-20","rounded-full","cursor-pointer","hover:scale-105","transition","border-2","border-transparent"),o.addEventListener("click",()=>{l=m,p.querySelectorAll("img").forEach(B=>{B.classList.remove("border-blue-500"),B.classList.add("border-transparent")}),o.classList.remove("border-transparent"),o.classList.add("border-blue-500")}),p.appendChild(o)}),u.addEventListener("click",()=>{n.classList.remove("hidden")}),w.addEventListener("click",()=>{n.classList.add("hidden")}),P.addEventListener("click",async()=>{if(!l){i("Please select an avatar!","warning");return}if(e.src=l,typeof a=="function"&&a(l),t)try{await L(y(E,"userprofiles",t),{profilePicture:l}),i("Avatar saved!","success")}catch(m){console.error("Failed to save avatar:",m),i("Failed to save avatar. Please try again later.","error")}n.classList.add("hidden")})}const v=document.getElementById("profileImage"),r=document.getElementById("username"),s=document.getElementById("email"),c=document.getElementById("pronouns"),k=document.getElementById("save-btn"),O=document.getElementById("logout-btn"),I=document.getElementById("error-msg"),f=document.getElementById("card-username"),b=document.getElementById("card-email");let d=null,g=!1;r.addEventListener("input",()=>{f&&(f.textContent=r.value.trim()||"Username")});function h(e){r.disabled=!e,c.disabled=!e,s.readOnly=!0,e?(r.style.backgroundColor="#f0f0f0",c.style.backgroundColor="#f0f0f0"):(r.style.backgroundColor="#e5e5e5",c.style.backgroundColor="#e5e5e5"),s.style.backgroundColor="#e5e5e5",k.textContent=e?"Save Changes":"Edit"}function S(e,t){const a=y(E,"userprofiles",e);U(a,u=>{if(!u.exists()||g)return;const n=u.data();r.value=n.username||"",c.value=n.pronouns||"",s.value=t||"",f&&(f.textContent=n.username||"Display Name"),b&&(b.textContent=t||"Email"),v&&n.profilePicture&&(v.src=n.profilePicture)})}async function q(){if(!d)return;const e=r.value.trim(),t=c.value.trim();if(!e){I.textContent="⚠️ Username is required!",r.focus();return}I.textContent="";try{await L(y(E,"userprofiles",d),{username:e,pronouns:t}),i("Profile updated!","success"),h(!1),g=!1}catch(a){console.error("Failed to update profile:",a),i("Failed to update profile. Please try again later.","error")}}k.addEventListener("click",e=>{e.preventDefault(),g?q():(g=!0,h(!0))});O.addEventListener("click",async()=>{await A(C),window.location.href="/login.html"});F(C,async e=>{if(!e){window.location.href="/login.html";return}d=e.uid;const t=e.email;s.value=t,s.readOnly=!0,s.style.pointerEvents="none",S(d,t),h(!1),D(v,d,a=>{console.log("Selected avatar:",a)})});
